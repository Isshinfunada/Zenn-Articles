---
title: 「作って学ぶブラウザのしくみ」学習記録：開発環境構築とWasabiOS入門
type: tech
emoji: 🌐
topics:
  - ブラウザ
  - Rust
  - WasabiOS
  - クロスコンパイル
  - 技術書
published: true
---
# 今日やったこと

「作って学ぶブラウザのしくみ」の学習を開始し、開発環境の構築を行った。Rust言語の開発ツールチェインをインストールし、自作OS「WasabiOS」上でサンプルブラウザアプリケーション（saba）を動かすための準備を進めた。最終的に、Hello Worldを出力するアプリケーションをWasabiOS上で実行することに成功した。

# 今日学んだこと

## Rustの開発環境とツールチェイン

- **rustup**: Rustのツールチェイン管理ツール。インストール・アップデート・バージョン管理に使用する
- **rustc**: Rustのコンパイラ。ソースコードをバイナリコードに変換する
- **cargo**: Rustのビルドツール。プロジェクトのビルド、テスト、デプロイに使用する

本書のプログラムはWasabiOSという自作OS上で動作するため、`nightly`バージョンのツールチェインを使用する必要がある。Rustには`nightly`、`beta`、`stable`という3段階のリリースサイクルがあり、`nightly`は最も実験的で最新の機能を含むバージョンで、毎日リリースされる。OS開発には`nightly`でしか使えない機能が必要なため、`rust-toolchain.toml`でバージョンを指定する。

## WasabiOSとQEMUエミュレータ

- **QEMU**: オープンソースのエミュレータ。あるコンピュータシステムが別のコンピュータシステムの機能を模倣するソフトウェア
- **WasabiOS**: 「作って学ぶOSのしくみ」で解説されている自作OS。本書のブラウザはこのOS上で動作する

ブラウザプログラムは2つのリポジトリ（サーバーとブラウザアプリ）に分かれており、`saba_core`にはHTML/CSS/JavaScriptを解釈してページをレンダリングする機能が実装されている。

## クロスコンパイルの仕組み

Rustのターゲットトリプル`x86_64-unknown-none`は3つの要素から構成される：

1. **CPUアーキテクチャ**: x86_64（64ビットx86プロセッサ）
2. **ベンダー**: unknown（特定のベンダーなし）
3. **OS環境**: none（ベアメタル環境）

通常、Macで開発する場合は`x86_64-apple-darwin`向けにビルドするが、WasabiOSという独自OS上で動かすため、ベアメタル環境向けにビルドする必要がある。

## no_std

WasabiOSはスタンダードライブラリに依存せずに書かれているため、アプリケーションも`#![no_std]`を指定してスタンダードライブラリに依存せずに書く必要がある。代わりに`noli`というwasabi OS用のライブラリを使用して、文字出力や図形描画などの機能を利用する。

## MacOSでのreadlink -f問題

今回1番の学び。
`run_with_app.sh`スクリプト内で使用されている`readlink -f`コマンドがMacOSで動作しない問題に遭遇した。

- **原因**: MacOSはBSD系のOSであり、Linux（GNU系）とは`readlink`コマンドの実装が異なる。GNU版では`-f`オプションで絶対パスを取得できるが、BSD版ではこのオプションがサポートされていない
- **解決策**: `realpath`コマンドを使用してバイナリのディレクトリを直接指定する方法で対応した

これはUnix派生OSでも実装の違いがあることを示す良い例で、`ls`や`cp`といった基本的なコマンドでも、LinuxとMacOSで挙動が異なる場合がある。

# 次にやること

- 書籍の第1章以降を読み進め、ブラウザの基本的な知識のおさらいをする

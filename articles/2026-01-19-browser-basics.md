---
title: "「作って学ぶブラウザのしくみ」学習記録：HTTPプロトコルの理解"
type: "tech"
emoji: "📖"
topics:
  - "ブラウザ"
  - "HTTP"
  - "技術書"
  - "ネットワーク"
published: false
---
# 今日やったこと

「作って学ぶブラウザのしくみ」の第3章を読み、HTTPプロトコルについて学習しました。HTTPの基本的な仕組みから、バージョン1.1、2、3の特徴、そしてHTTPメッセージの構成要素について理解を深めました。

# 今日学んだこと

## HTTPの基本的な役割

HTTPはTCP/IP におけるアプリケーション層に位置するプロトコルで、クライアントとサーバー間でバイナリ形式（1.1の頃はテキストベース）のリクエストとレスポンスを交換します。ブラウザがリクエストを送信し、サーバーがステータスコード、ヘッダー、本文を含むレスポンスを返すという基本的な流れで動作します。

## HTTP/1.1の特徴と課題

HTTP/1.1では持続的接続（Keep-Alive）が導入され、1つのTCP接続で複数のリクエストとレスポンスを処理できるようになりました。これにより、ページ内の画像やJavaScript、CSSなどのリソースを取得するために何度もTCP接続を確立する必要がなくなりました。

また、**パイプライン化**も導入され、レスポンスを待たずに複数のリクエストを送信できるようになりました。しかし、サーバーはリクエストを受信した順序と同じ順序で応答を送信する必要があり、1つのレスポンスが遅延すると後続のレスポンスもブロックされる**HOL（Head-of-Line）ブロッキング**の問題が発生するため、現在ではあまり利用されていません。

## HTTP/2の進化と103 Early Hints

HTTP/2では**マルチプレクシング**が導入され、1つのTCP接続上にストリームと呼ばれる仮想的な接続を複数作成することで、複数のリクエストとレスポンスを同時に処理できるようになりました。ただしHTTPレベルのHOLブロッキングは解消したものの、TCPレベルのHOLが残っていたため、後述のHTTP3が開発される動機になりました。

当初、**サーバープッシュ**機能も導入されましたが、複雑な実装とオーバーヘッド、利用率の低さ、パフォーマンス上のメリットの薄さなどを理由に、2022年にChromeはサポートを終了しました。

その代替案として登場したのが**103 Early Hints**です。これは、サーバーが最終的なレスポンス（通常200 OKなど）を準備する前に、必要になるリソースのヒントをブラウザに伝える仕組みです。ブラウザは最終レスポンスを待つ間に必要なリソースのダウンロードを先行して開始でき、ページの表示速度を向上させることができます。

実際の利用例として、CDNがサーバーサイドレンダリング（SSR）において必要なCSSなどを先に取得させるために103 Early Hintsを使うことがあります。エッジサーバー（CloudflareなどのCDN）が過去の200レスポンスに含まれていたリンクを記憶し、次回のリクエストで103として返すという形で実装されています。
参考: https://blog.cloudflare.com/early-hints/#early-hints-in-a-nutshell

## HTTP/3とQUIC

HTTP/3は**QUIC（Quick UDP Internet Connections）**プロトコルをベースにしており、**UDP上で通信を行う**という大きな特徴があります。従来のTCPよりも高速な通信を実現し、TCPの制約による遅延やブロッキングを回避できます。

QUICはUDPを使用しながらも、パケット損失時の再送やシーケンス番号によるデータの順序保証を行い、TCP と同等以上の信頼性を担保しています。複数のストリームを独立して処理することで、HTTP/1.1やTCPで発生したHOLブロッキングを回避できる点が大きな利点です。

## HTTPメッセージの構成

HTTPメッセージは以下の3つの要素で構成されています：

- **スタートライン**: リクエストの場合はリクエストライン（メソッド、リクエストターゲット、HTTPバージョン）、レスポンスの場合はステータスライン（HTTPバージョン、ステータスコード、理由フレーズ）
- **ヘッダー**: キーとバリューのセットで構成され、HTTP/1.1以降はHostヘッダーが必須
- **ボディ**: GETリクエストでは通常空、POST/PUTでは更新内容、GETレスポンスにはHTMLなどのリソース内容が含まれる

特に重要なのは、クライアントはステータスコードに基づいて挙動を変えるべきであり、理由フレーズ（テキスト形式の説明）は無視する必要があるという点です。

# 次にやること

次回は、実際にHTTPクライアントの実装に入ります。URLを指定するとHTTPレスポンスが返ってくるプログラムを作成し、その動作を確認する予定です。

---
title: "「作って学ぶブラウザのしくみ」学習記録：URLパーサーのテスト実装"
type: "tech"
emoji: "🧪"
topics:
  - "ブラウザ"
  - "Rust"
  - "テスト"
  - "技術書"
published: true
---
# 今日やったこと

「作って学ぶブラウザのしくみ」の第2章を進め、URLパーサーの失敗ケースに対するユニットテストを実装しました。前回の成功ケースのテストに続いて、今回はエラーハンドリングの部分を検証するテストを追加し、第2章のURLパース部分を完了させました。

# 今日学んだこと

## URLパースの失敗ケースの設計

URLパーサーが失敗する可能性があるケースとして、以下の2つのシナリオを想定しました：

- **スキームが存在しない場合**: URLにスキーム部分が含まれていないケース
- **HTTP/HTTPS以外のスキームが設定された場合**: 対応していないプロトコルが指定されたケース

これらのケースでは、パースメソッドが適切にエラーを返すべきであることを確認する必要がありました。

## テスト実装と問題の修正

失敗ケースのテストコードを追加した後、`cargo test`コマンドでテストを実行したところ、いくつかのテストが失敗しました。原因を調査すると、**エラーメッセージの内容が期待値と異なっていた**ことが判明しました。

具体的には、テストで期待していたエラーメッセージと、実際にパーサーが返すエラーメッセージが一致していなかったため、テストケース側で期待値を修正することで問題を解決しました。適切なエラーメッセージとスキームを設定し直すことで、すべてのテストが通るようになりました。

## Rustのテストモジュールの理解

今回の実装を通じて、Rustの`cargo test`コマンドを使用したテスト実行の流れを理解できました：

- テストケースを追加したらすぐに実行して動作を確認する
- 失敗したテストのエラーメッセージから原因を特定する
- テストコードと実装コードの両方を見直して修正する

特に、テストモジュール（`#[cfg(test)]`モジュール）内でテスト関数（`#[test]`属性付き関数）を定義することで、実装コードとテストコードを分離しつつ、効率的にテストを実行できることを学びました。

# 次にやること

第2章のURLパース部分が完了したので、次回は第3章に進む予定です。今回はテストの追加だけで終わったため、次回はもう少し長めの時間を確保して、新しい機能の実装に取り組みたいと思います。

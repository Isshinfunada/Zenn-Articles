---
title: "作って学ぶブラウザのしくみ：URLの構文解析とRustの基礎"
type: "tech"
emoji: "🌐"
topics:
  - "ブラウザ"
  - "Rust"
  - "URL"
  - "技術書"
published: true
---
# 今日やったこと

「作って学ぶブラウザのしくみ」の第2章を読み進め、URLを分解するプログラムの実装を開始しました。URLの基本的な構造を理解し、Rustでライブラリクレートを作成してUrl構造体を定義するところまで進めました。

# 今日学んだこと

## URLの基本構造

URLは特定のリソースにアクセスするための識別子で、RFC 1738によって定義されています。（今日では汎用構文として基準になっているのはRFC 3986）。本書ではRFC 1738に則ってHTTPスキームのみを実装することになりました。URLは以下の要素で構成されます：

- **スキーム**: リソースにアクセスするために使用されるプロトコルの名前（HTTP）
- **ホスト**: FQDN（完全修飾ドメイン名）またはIPアドレス
- **ポート番号**: サーバの特定のサービスにアクセスするための番号（HTTPのデフォルトは80）
- **パス**: サーバ内の階層化されたリソースを指定
- **クエリパラメータ**: キー=値の形式で追加情報を提供

## Rustのクレートとワークスペース

新しいライブラリクレート「saba_core」を作成しました。クレートはRustにおけるコンパイルの単位で、2種類あります：

- **バイナリクレート**: 実行可能なバイナリを提供（main関数が必須）
- **ライブラリクレート**: 再利用可能なコードのコレクション

ワークスペース機能を使うと、複数の関連するRustプロジェクトを一つのディレクトリでまとめて管理できます。ワークスペース内で`cargo new --lib`コマンドでライブラリクレートを作成すると、自動的にワークスペースにメンバーが追加されます。

## Url構造体とメソッドの定義

`Url`構造体を定義し、URLのデータを保持するようにしました：

```rust
#[derive(Debug, Clone, PartialEq)]
pub struct Url {
    url: String,
    host: String,
    port: String,
    path: String,
    searchpart: String,
}
```

`derive`属性を使うことで、Debug、Clone、PartialEqトレイトを自動実装できます。これにより、デバッグ表示やコピー、値の比較が簡単に行えます。

## Rustのミュータビリティ（可変性）

Rustでは変数はデフォルトでイミュータブル（不変）です。変更したい場合は`mut`キーワードを使ってミュータブルにする必要があります。

今回`parse`メソッドでは引数に`&mut self`を使います。これはメソッドが可変な参照経由でオブジェクト自体にアクセスすることを示し、コンストラクタで作成した空文字のフィールドをメソッド内で変更できるようになります。

## allocクレートとメモリ領域

`alloc`クレートはヒープ領域への動的メモリ確保の機能を提供します。`extern crate alloc;`でこのクレートをリンクして使用します。

- **スタック領域**: 一時的な小さなデータに使用、確保と解放が自動で高速
- **ヒープ領域**: 可変で大きなデータ（Stringなど）に使用、必要な分だけ確保・解放

Stringはサイズが可変なため、実際の文字列データはヒープに置かれます。

## 外部ライブラリを使わない方針

本書のプロジェクトでは、標準ライブラリに依存しない`no_std`環境であり、Rust自体の学習のために外部ライブラリを一切使わない方針です。正規表現ライブラリ（regex）なども使わず、すべて自分で実装します。

# 次にやること

次回は`parse`メソッドの中身を実装し、URLの文字列を各要素（スキーム、ホスト、ポート、パス、クエリパラメータ）に分割する処理を書いていきます。正規表現を使わずにURLをパースする方法を学んでいく予定です。
